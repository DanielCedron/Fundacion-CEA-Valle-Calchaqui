<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Invitación Especial</title>
    <!-- Tailwind CSS para estilos rápidos de estructura -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- ESTILOS GENERALES Y FUENTES --- */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;600&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* Evitar scroll */
            font-family: 'Poppins', sans-serif;
            background-color: #33caff; /* Fallback color */
        }

        /* Canvas del fondo (OLAS) */
        #glcanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            pointer-events: none;
        }

        /* --- PANTALLA 1: EL SOBRE (Intro) --- */
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.4); /* Fondo semitransparente para resaltar el sobre */
            transition: opacity 1s ease, transform 1s ease;
            backdrop-filter: blur(5px);
        }

        .envelope-container {
            position: relative;
            cursor: pointer;
            animation: bounce 2s infinite;
        }

        /* Dibujo del sobre con CSS puro */
        .envelope {
            width: 300px;
            height: 200px;
            background: #fdfbf7;
            position: relative;
            border-radius: 5px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .envelope::after { /* Solapa de abajo */
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0; 
            height: 0; 
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-bottom: 100px solid #e6e2d8;
            z-index: 3;
        }

        .flap { /* Solapa de arriba (Cerrada) */
            position: absolute;
            top: 0;
            left: 0;
            width: 0; 
            height: 0; 
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 110px solid #dcd8cc;
            transform-origin: top;
            transition: transform 0.6s ease;
            z-index: 4;
        }
        
        .seal { /* Sello de lacre */
            position: absolute;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: #d64541;
            border-radius: 50%;
            z-index: 5;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            border: 2px solid #b33936;
            transition: opacity 0.4s;
        }

        .tap-hint {
            margin-top: 30px;
            color: white;
            font-size: 1.2rem;
            background: rgba(0,0,0,0.6);
            padding: 8px 20px;
            border-radius: 20px;
            animation: pulse 2s infinite;
        }

        /* Animación de apertura */
        .envelope-container.open .flap {
            transform: rotateX(180deg);
            z-index: 1; /* Se va para atrás */
        }
        .envelope-container.open .seal {
            opacity: 0;
        }
        
        /* --- PANTALLA 2: CONTENIDO PRINCIPAL --- */
        #main-content {
            position: relative;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: none; /* Oculto al inicio */
            opacity: 0;
            transition: opacity 1s ease;
        }

        /* Elementos Flotantes */
        
        /* 1. Rebote aleatorio (350x350) */
        #img-bounce {
            position: absolute;
            width: 350px;
            height: 350px;
            object-fit: contain;
            z-index: 11;
            /* Placeholder styling */
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        /* 2. Brisa Esq Sup Izquierda (200x200) */
        #img-top-left {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 200px;
            height: 200px;
            object-fit: contain;
            z-index: 12;
            animation: breeze 5s ease-in-out infinite alternate;
        }

        /* 3. Brisa Esq Sup Derecha (200x200) */
        #img-top-right {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 200px;
            object-fit: contain;
            z-index: 12;
            animation: breeze 6s ease-in-out infinite alternate-reverse;
        }

        /* 4. Centro Cambio Color (300x300) */
        #img-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            object-fit: contain;
            z-index: 13;
            animation: colorShift 4s linear infinite;
        }

        /* Botón Elegante */
        .btn-elegant {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            background: linear-gradient(135deg, #fdfbf7 0%, #e6e2d8 100%);
            color: #4a4a4a;
            padding: 15px 40px;
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            font-weight: bold;
            border: 1px solid #dcd8cc;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
            letter-spacing: 2px;
            white-space: nowrap;
        }

        .btn-elegant:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* --- MODAL y FORMULARIO --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-overlay.active .modal-box {
            transform: scale(1);
        }

        /* --- PANTALLA FINAL (Dirección) --- */
        #final-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white; /* O un color sólido si prefieres */
            z-index: 200;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        #final-screen.active {
            opacity: 1;
            pointer-events: auto;
        }
        .final-img {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        /* --- ANIMACIONES KEYFRAMES --- */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.8; }
        }

        @keyframes breeze {
            0% { transform: rotate(0deg) translateY(0); }
            50% { transform: rotate(3deg) translateY(-5px); }
            100% { transform: rotate(-2deg) translateY(0); }
        }

        @keyframes colorShift {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        /* Utilidad */
        .hidden { display: none !important; }
        
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #eee;
            border-radius: 8px;
            font-family: inherit;
        }
        input:focus {
            outline: none;
            border-color: #33caff;
        }
    </style>
</head>
<body>

    <!-- 0. FONDO DE AGUA (WEBGL) -->
    <canvas id="glcanvas"></canvas>

    <!-- 1. PANTALLA DE INTRODUCCIÓN (SOBRE) -->
    <div id="intro-screen">
        <div class="envelope-container" onclick="openEnvelope()">
            <div class="envelope">
                <div class="flap"></div>
                <div class="seal"></div>
            </div>
        </div>
        <div class="tap-hint">Toque la pantalla para abrir</div>
    </div>

    <!-- 2. CONTENIDO PRINCIPAL -->
    <div id="main-content">
        <!-- Imágenes Flotantes -->
        <!-- NOTA: Reemplaza src con tus imagenes.png locales -->
        
        <!-- Bouncing aleatorio (350x350) -->
        <img src="INVITACIONES/inv2/FLOTADOR.png" alt="Decoración" id="img-bounce">

        <!-- Esquina Sup Izq (200x200) - Brisa -->
        <img src="INVITACIONES/inv2/LLERBA1.png" alt="Viento" id="img-top-left">

        <!-- Esquina Sup Der (200x200) - Brisa -->
        <img src="INVITACIONES/inv2/LLERBA2.png" alt="Viento" id="img-top-right">

        <!-- Centro (300x300) - Cambio de color -->
        <img src="INVITACIONES/inv2/CARTEL.png" alt="Centro" id="img-center">

        <!-- Botón -->
        <button class="btn-elegant" onclick="showRSVP()">
            Confirmar asistencia
        </button>
    </div>

    <!-- 3. MODAL CONFIRMACIÓN -->
    <div class="modal-overlay" id="rsvp-modal">
        <div class="modal-box">
            <h2 class="text-2xl font-bold mb-4 font-serif text-gray-800">¿Cuál es tu nombre?</h2>
            <form id="fm1" onsubmit="submitForm(event)">
                <input type="text" id="nombre" name="nombre" placeholder="Nombre Completo" required>
                
                <!-- Campos ocultos de FormSubmit -->
                <input type="hidden" name="_next" value="https://danielcedron.github.io/Fundacion-CEA-Valle-Calchaqui/INVITACION-2.html">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_template" value="table">

                <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg font-bold mt-2 hover:bg-blue-600 transition">
                    ENVIAR
                </button>
                <button type="button" class="mt-3 text-gray-500 text-sm underline" onclick="closeRSVP()">
                    Cancelar
                </button>
            </form>
        </div>
    </div>

    <!-- 4. PANTALLA FINAL (DIRECCIÓN) -->
    <div id="final-screen">
        <h1 class="text-3xl font-serif font-bold text-gray-800 mb-4">¡Gracias por confirmar!</h1>
        <img src="https://placehold.co/600x400/jpg?text=Mapa+o+Lugar" class="final-img" alt="Lugar del evento">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
            <h3 class="text-xl font-bold text-gray-700 mb-2">Dirección:</h3>
            <p class="text-lg text-gray-600">La Valle 174</p>
            <p class="text-gray-500">Casa del niño, puerta con rejas</p>
        </div>
    </div>

    <!-- ELEMENTO DE AUDIO (Oculto) -->
    <!-- NOTA: Coloca tu archivo 'musica.mp3' en la misma carpeta -->
    <audio id="bg-music" loop>
        <source src="INVITACIONES/inv2/musica.mp3" type="audio/mpeg">
    </audio>


    <!-- SCRIPTS -->
    <script>
        // --- 1. CONFIGURACIÓN DEL FONDO (WEBGL - Olas) ---
        // (Código proporcionado por el usuario, minificado dentro de la lógica)
        const vert = `attribute vec2 position;void main() {gl_Position = vec4(position, 0.0, 1.0);}`;
        const frag = `precision highp float;uniform float time;uniform vec2 resolution;float hash(vec2 p) {return fract(sin(dot(p, vec2(41.0, 289.0))) * 45758.5453);}float noise(vec2 p){vec2 i = floor(p);vec2 f = fract(p);float a = hash(i);float b = hash(i + vec2(1.0, 0.0));float c = hash(i + vec2(0.0, 1.0));float d = hash(i + vec2(1.0, 1.0));vec2 u = f*f*(3.0-2.0*f);return mix(a, b, u.x) + (c - a)*u.y*(1.0-u.x) + (d - b)*u.x*u.y;}void main(){vec2 uv = gl_FragCoord.xy / resolution.xy;uv.x *= resolution.x / resolution.y;float t = time * 0.35;float w1 = noise(uv * 5.0 + vec2(t * 0.7,  t * 0.9));float w2 = noise(uv * 9.0 - vec2(t * 1.2,  t * 0.8));float w3 = noise(uv * 14.0 + vec2(t * 0.4, -t * 1.5));float combined = w1 * 0.55 + w2 * 0.30 + w3 * 0.15;float caustics = pow(abs(combined), 7.0);vec3 water = vec3(0.12, 0.55, 0.85);vec3 light = vec3(1.7, 1.9, 2.2) * caustics * 1.4;vec3 color = water + light;gl_FragColor = vec4(color, 1.0);}`;

        const canvas = document.getElementById("glcanvas");
        const gl = canvas.getContext("webgl");

        function initWebGL() {
            canvas.width = innerWidth;
            canvas.height = innerHeight;
            function compile(type, source) {
                const s = gl.createShader(type);
                gl.shaderSource(s, source);
                gl.compileShader(s);
                return s;
            }
            const vs = compile(gl.VERTEX_SHADER, vert);
            const fs = compile(gl.FRAGMENT_SHADER, frag);
            const program = gl.createProgram();
            gl.attachShader(program, vs);
            gl.attachShader(program, fs);
            gl.linkProgram(program);
            gl.useProgram(program);
            const position = gl.getAttribLocation(program, "position");
            const buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(position);
            gl.vertexAttribPointer(position, 2, gl.FLOAT, false, 0, 0);
            const timeLoc = gl.getUniformLocation(program, "time");
            const resLoc = gl.getUniformLocation(program, "resolution");
            function render(t) {
                gl.viewport(0, 0, canvas.width, canvas.height);
                gl.uniform1f(timeLoc, t * 0.001);
                gl.uniform2f(resLoc, canvas.width, canvas.height);
                gl.drawArrays(gl.TRIANGLES, 0, 6);
                requestAnimationFrame(render);
            }
            render(0);
        }
        initWebGL();
        window.onresize = () => { canvas.width = innerWidth; canvas.height = innerHeight; };

        // --- 2. LÓGICA DE INTERACCIÓN ---

        // Verificar si ya completó el formulario anteriormente
        window.addEventListener('load', () => {
            if(localStorage.getItem('asistenciaConfirmada') === 'true') {
                document.getElementById('intro-screen').style.display = 'none';
                document.getElementById('final-screen').classList.add('active');
            }
        });

        function openEnvelope() {
            const envelopeContainer = document.querySelector('.envelope-container');
            const introScreen = document.getElementById('intro-screen');
            const mainContent = document.getElementById('main-content');
            const music = document.getElementById('bg-music');

            // 1. Animar sobre
            envelopeContainer.classList.add('open');

            // 2. Tocar música (Requiere interacción del usuario, por eso está aquí)
            music.volume = 0.5;
            music.play().catch(e => console.log("Audio autoplay policy check:", e));

            // 3. Transición
            setTimeout(() => {
                introScreen.style.opacity = 0;
                setTimeout(() => {
                    introScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                    // Pequeño delay para el fade in
                    setTimeout(() => {
                        mainContent.style.opacity = 1;
                        initBouncingImage(); // Iniciar rebote
                    }, 100);
                }, 1000);
            }, 800);
        }

        // --- 3. LÓGICA DE IMAGEN QUE REBOTA (DVD Screensaver style) ---
        function initBouncingImage() {
            const img = document.getElementById('img-bounce');
            const container = document.body;
            
            let x = Math.random() * (window.innerWidth - 350);
            let y = Math.random() * (window.innerHeight - 350);
            let dx = 2; // Velocidad X
            let dy = 2; // Velocidad Y

            function animateBounce() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                const imgSize = 350;

                // Actualizar posición
                x += dx;
                y += dy;

                // Colisión Paredes (Sin salirse de la visión)
                if (x + imgSize >= width) {
                    x = width - imgSize;
                    dx = -dx;
                } else if (x <= 0) {
                    x = 0;
                    dx = -dx;
                }

                if (y + imgSize >= height) {
                    y = height - imgSize;
                    dy = -dy;
                } else if (y <= 0) {
                    y = 0;
                    dy = -dy;
                }

                img.style.transform = `translate(${x}px, ${y}px)`;
                requestAnimationFrame(animateBounce);
            }
            animateBounce();
        }

        // --- 4. FORMULARIO Y MODAL ---
        function showRSVP() {
            document.getElementById('rsvp-modal').classList.add('active');
        }

        function closeRSVP() {
            document.getElementById('rsvp-modal').classList.remove('active');
        }

        function submitForm(event) {
            event.preventDefault(); // Evitar recarga tradicional
            const form = event.target;
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerText;

            btn.innerText = "Enviando...";
            btn.disabled = true;

            // Usamos Fetch para enviar a FormSubmit sin redireccionar
            fetch("https://formsubmit.co/ajax/danielcedron8@gmail.com", {
                method: "POST",
                headers: { 
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    nombre: form.nombre.value,
                    _captcha: "false"
                })
            })
            .then(response => response.json())
            .then(data => {
                // Guardar en LocalStorage
                localStorage.setItem('asistenciaConfirmada', 'true');
                
                // Ocultar modal e ir a final
                closeRSVP();
                document.getElementById('main-content').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('main-content').style.display = 'none';
                    document.getElementById('final-screen').classList.add('active');
                }, 500);
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Hubo un error al enviar. Por favor intenta de nuevo.");
                btn.innerText = originalText;
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>